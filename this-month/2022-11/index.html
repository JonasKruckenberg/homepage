<!doctype html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Operating System Development in Rust">

    
        <link rel="canonical" href="https://rust-osdev.com/this-month/2022-11/" />
    
    <link href="/css/poole.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="RSS feed for rust-osdev.com" href="https://rust-osdev.com/rss.xml" />

    <title>This Month in Rust OSDev: November 2022 | Rust OSDev</title>
</head>

<body>
    <div class="wrap">
        <div class="masthead">
          <div class="container">
            <h3 class="masthead-title">
              <a href="https://rust-osdev.com" title="Home">Rust OSDev</a>
              <small>Operating System Development in Rust</small>
            </h3>
          </div>
        </div>
  
        <div class="container content">
            <main>
    <h1>This Month in Rust OSDev: November 2022</h1>

    <span class="post-authors post-date">Published on <time datetime="2022-12-07">
            Dec 07, 2022
            
        </time>(edited by
        <a href="https://github.com/phil-opp">@phil-opp</a>)</span>

    <p>Welcome to a new issue of <em>&quot;This Month in Rust OSDev&quot;</em>. In these posts, we give a regular overview of notable changes in the Rust operating system development ecosystem.</p>
<span id="continue-reading"></span>
<p>This series is openly developed <a href="https://github.com/rust-osdev/homepage/">on GitHub</a>. Feel free to open pull requests there with content you would like to see in the next issue. If you find some issues on this page, please report them by <a href="https://github.com/rust-osdev/homepage/issues/new">creating an issue</a> or using our <a href="#comment-form"><em>comment form</em></a> at the bottom of this page.</p>
<p>We have some new sections this month, we hope you like the content!</p>
<!--
    This is a draft for the upcoming "This Month in Rust OSDev (November 2022)" post.
    Feel free to create pull requests against the `next` branch to add your
    content here.
    Please take a look at the past posts on https://rust-osdev.com/ to see the
    general structure of these posts.
-->
<h2 id="infrastructure-and-tooling">Infrastructure and Tooling</h2>
<p>In this section, we collect recent updates to <code>rustc</code>, <code>cargo</code>, and other tooling that are relevant to Rust OS development.</p>
<h3 id="uefi-targets-are-now-tier-2">UEFI Targets are now Tier 2</h3>
<p><span class="maintainers">(Section written by <a href="https://github.com/nicholasbishop">@nicholasbishop</a>)</span></p>
<p>The <a href="https://github.com/rust-lang/compiler-team/issues/555">MCP to raise the three UEFI targets to tier 2</a> by <a href="https://github.com/dvdhrm">@dvdhrm</a> was recently approved.
Following that we merged a PR to <a href="https://github.com/rust-lang/rust/pull/103933">dist builds of the UEFI targets</a> so that you can install them via rustup (e.g. <code>rustup target add --toolchain nightly x86_64-unknown-uefi</code>), and a PR to <a href="https://github.com/rust-lang/rust/pull/101703">add an initial QEMU test</a> for the x86_64 UEFI target to help prevent regressions from landing.</p>
<p>The initial nightlies containing the prebuilt UEFI targets revealed some issues in <code>compiler_builtins</code> which we fixed and are in the <a href="https://github.com/rust-lang/compiler-builtins/compare/0.1.83...0.1.84">0.1.84</a> release.
Finally, we <a href="https://github.com/rust-lang/rust/pull/104622">changed the C compiler for the UEFI targets from gcc to clang</a>, which resolved some linker problems.
As of the 2022-11-22 nightly, the three UEFI targets should be fully usable, which means you no longer need to use the unstable <code>-Zbuild-std</code> feature.</p>
<h2 id="announcements-news-and-blog-posts">Announcements, News, and Blog Posts</h2>
<ul>
<li><a href="https://www.redox-os.org/news/release-0.8.0/">Redox OS 0.8.0</a></li>
<li><span class="gray">[Talk]</span> <a href="https://www.youtube.com/watch?v=osepBlSQjY8">FerrOS: Rust-y unikernels on seL4</a></li>
<li><a href="https://www.reddit.com/r/rust/comments/ytrpss/aero_a_new_modern_os_made_in_rust_and_is_now_able/">Aero, a new modern OS made in rust and is now able to run Xorg</a></li>
<li><a href="https://asahilinux.org/2022/11/tales-of-the-m1-gpu/">Tales of the M1 GPU</a>
<ul>
<li>Asahi Lina shares her experience with writing a Linux kernel driver for the Apple M1 GPU in Rust.</li>
</ul>
</li>
<li><a href="https://security.googleblog.com/2022/12/memory-safe-languages-in-android-13.html">Memory Safe Languages in Android 13</a>
<ul>
<li>There are now ~1.5 million lines of Rust code in AOSP.</li>
<li>&quot;Based on this historical vulnerability density, itâ€™s likely that using Rust has already prevented hundreds of vulnerabilities from reaching production.&quot;</li>
</ul>
</li>
<li><a href="https://www.phoronix.com/news/More-Rust-Upstream-Prep-Linux">Rust Developers Move Ahead With Preparing To Upstream More Code Into The Linux Kernel</a></li>
</ul>
<!--
Here we collect news, blog posts, etc. related to OS development in Rust.
Please follow this template:

- [Title](https://example.com)
  - (optional) Some additional context
-->
<h2 id="rust-osdev-projects"><code>rust-osdev</code> Projects</h2>
<p>In this section, we give an overview of notable changes to the projects hosted under the <a href="https://github.com/rust-osdev/about"><code>rust-osdev</code></a> organization.</p>
<!--
    Please use the following template:

    ### [`repo_name`](https://github.com/rust-osdev/repo_name)
    <span class="maintainers">Maintained by [@maintainer_1](https://github.com/maintainer_1)</span>

    The `repo_name` crate ...<<short introduction>>...

    We merged the following changes this month:
    <<changelog, either in list or text form>>
-->
<h3 id="bootloader"><a href="https://github.com/rust-osdev/bootloader"><code>bootloader</code></a></h3>
<p><span class="maintainers">Maintained by <a href="https://github.com/phil-opp">@phil-opp</a></span></p>
<p>Just a few days ago, we finally <a href="https://github.com/rust-osdev/bootloader/pull/293">released</a> version <code>0.11.0</code> of the the <code>bootloader</code> crate. This release is a <a href="https://github.com/rust-osdev/bootloader/pull/232">major rewrite</a> with various new features and also breaking changes:</p>
<ul>
<li><strong>Separate API crate:</strong> The bootloader is now split into two parts: A <a href="https://docs.rs/bootloader_api/0.11.0/bootloader_api/"><code>bootloader_api</code></a> crate to make kernels loadable by the bootloader and the actual bootloader implementation. This makes the build process for kernels much easier and faster.</li>
<li><strong>New config system:</strong> Instead of configuring the bootloader via a special table in the <code>Cargo.toml</code>, the configuration now happens through a normal Rust struct, which is part of the <a href="https://docs.rs/bootloader_api/0.11.0/bootloader_api/macro.entry_point.html"><code>entry_point!</code> macro</a>. The macro then serializes the config struct at compile time and places it in a special ELF output section. The compile time serialization happens through a manually implemented <code>const fn</code> of the config struct.</li>
<li><strong>Load the kernel at runtime:</strong> Up to version <code>0.10</code>, the bootloader used to link the kernel at compile time, which required recompiling the bootloader whenever the kernel was modified. In <code>v0.11</code>, we now load both the kernel and the configuration at runtime, so no rebuilding of the bootloader is needed anymore.</li>
<li><strong>Split into sub-crates:</strong> Since the bootloader build process does not need access to the kernel executable or its <code>Cargo.toml</code> anymore, we can build the different parts of the bootloader independently. For example, the BIOS boot sector is now a separate crate, and the UEFI bootloader is too. (We plan to make them proper <a href="https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#artifact-dependencies">artifact dependencies</a> as soon as they're allowed on crates.io.)</li>
<li><strong>Library to create disk images:</strong> To create an abstraction the complex build steps of the different bootloader executables, we compile them inside cargo build scripts. At the top level, we provide a <a href="https://docs.rs/bootloader/0.11.0/bootloader/"><code>bootloader</code></a> <em>library</em> crate, which compiles everything as part of its build script. This library includes functions for creating BIOS and UEFI disk images for a given kernel. These functions can be used e.g. from a builder crate or a build script of the downstream operating system.</li>
</ul>
<p>See our <a href="https://github.com/rust-osdev/bootloader/blob/main/README.md">README</a> for detailed usage instructions. We also created <a href="https://github.com/rust-osdev/bootloader/tree/main/docs/migration">migration guides</a> that explain how to update from <code>v0.9</code> and <code>v0.10</code>.</p>
<p>Thanks a lot to the numerous people that tested our beta releases and reported issues!</p>
<h3 id="uefi-rs"><a href="https://github.com/rust-osdev/uefi-rs"><code>uefi-rs</code></a></h3>
<p><span class="maintainers">Maintained by <a href="https://github.com/GabrielMajeri">@GabrielMajeri</a>, <a href="https://github.com/nicholasbishop">@nicholasbishop</a>, and <a href="https://github.com/phip1611">@phip1611</a></span></p>
<h4 id="features">Features</h4>
<ul>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/544">Make the <code>cstr16!</code> macro usable in const contexts</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/545">const fn for trivial getters where possible</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/549">Support ISA-specific <code>MemoryAttribute</code>s in <code>MemoryDescriptor</code>s</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/552">Allow uefi-services to work when the &quot;logger&quot; feature is disabled in uefi</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/551">Unicode collation</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/547">Add structs for all device path node types and a new <code>DevicePathBuilder</code></a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/550">Implement additional <code>BootServices</code> functions</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/571">Publish new releases</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/546">const fn wherever possible</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/561">rename crate features</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/580">Several small improvements to EqStrUntilNul</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/581"><code>TryFrom&lt;core::ffi::CStr&gt;</code> implementation for <code>CStr8</code></a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/559"><code>Directory::read_entry_boxed</code> plus common abstraction <code>make_boxed</code></a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/587">Implement Error trait for <code>uefi::Error</code></a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/584">Added <code>read_entry_boxed_in</code> and <code>get_boxed_info_in</code> that use the <code>allocator_api</code></a></li>
</ul>
<h4 id="docs">Docs</h4>
<ul>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/577">Add uefi/README.md</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/555">Install UEFI targets via rustup</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/586">book: Add a graphics example</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/556">documentation and code improvements for Status, Error, and read()</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/589">Clean up crate feature list documentation</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/590">Add <code>unstable</code> feature and improve CI for feature flags</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/588">Doc updates: add &quot;Running on Hardware&quot; to book and drop BUILDING.md</a></li>
</ul>
<h4 id="internal">Internal</h4>
<ul>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/543">Update <code>mbrman</code> to 0.5.0</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/534">Don't explicitly require compiler-builtins(-mem)</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/574">Add temporary workaround for yanked dependency</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/566">workspace: uefi (main library) is in a dedicated directory now</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/576">Copy LICENSE to the new uefi directory</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/578">Improve clap help for <code>--target</code></a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/562">several unrelated cleanups</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/579">uefi-test-runner: Assume that we're running in the special QEMU env</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/582">Simplify serial usage in test-runner and check that tests completed</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/592">clippy: require must_use_candidate lint</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/569">doc: add '--document-private-items' to <code>cargo xtask doc</code></a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/595">test-runner: Make some tests stricter</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/598">test-runner: Open serial device in exclusive mode</a></li>
<li><a href="https://github.com/rust-osdev/uefi-rs/pull/599">Make GOP test work on aarch64</a></li>
</ul>
<!--
#### Other, less notable changes
- [Fix `cargo xtask test` help text](https://github.com/rust-osdev/uefi-rs/pull/542)
- [Fix location of a changelog item](https://github.com/rust-osdev/uefi-rs/pull/548)
- [fs-tests: doc improvements](https://github.com/rust-osdev/uefi-rs/pull/558)
- [changelog: add publish date to all versions](https://github.com/rust-osdev/uefi-rs/pull/567)
- [update PUBLISHING.md](https://github.com/rust-osdev/uefi-rs/pull/568)
- [build(deps): update nix requirement from 0.25.0 to 0.26.1](https://github.com/rust-osdev/uefi-rs/pull/597)
-->
<p>Thanks to <a href="https://github.com/blitz">@blitz</a>, <a href="https://github.com/YtvwlD">@YtvwlD</a>, <a href="https://github.com/timrobertsdev">@timrobertsdev</a>, <a href="https://github.com/NathanRoyer">@NathanRoyer</a>, and <a href="https://github.com/d-sonuga">@d-sonuga</a> for their contributions!</p>
<h3 id="linked-list-allocator"><a href="https://github.com/rust-osdev/linked-list-allocator"><code>linked-list-allocator</code></a></h3>
<p><span class="maintainers">Maintained by <a href="https://github.com/phil-opp">@phil-opp</a> and <a href="https://github.com/jamesmunns">@jamesmunns</a></span></p>
<p>We merged the following tooling changes this month to make the crate more reliable:</p>
<ul>
<li><a href="https://github.com/rust-osdev/linked-list-allocator/pull/73">Detect fragmentation when fuzzing</a></li>
<li><a href="https://github.com/rust-osdev/linked-list-allocator/pull/75">Fix miri test failures caused by address unleaking of heap data in tests</a></li>
</ul>
<p>Thanks to <a href="https://github.com/evanrichter">@evanrichter</a> for their contribution!</p>
<h3 id="acpi"><a href="https://github.com/rust-osdev/acpi"><code>acpi</code></a></h3>
<p><span class="maintainers">Maintained by <a href="https://github.com/IsaacWoods">@IsaacWoods</a></span></p>
<ul>
<li><a href="https://github.com/rust-osdev/acpi/pull/132">Improve <code>PciConfigRegions</code> API</a></li>
</ul>
<p>Thanks to <a href="https://github.com/semiviral">@semiviral</a> for their contribution!</p>
<h2 id="call-for-participation">Call for Participation</h2>
<p>Want to contribute to a Rust OSDev project, but don't know where to start? Help with one of these outstanding issues!</p>
<!--
    Please use the following template for adding items:
    - [(`repo_name`) Issue Description](https://example.com/link-to-issue)
-->
<span class="gray">
<p><em>No tasks were proposed for this section this month.</em></p>
</span>
<p>If you maintain a Rust project related to operating system development and are looking for contributors, especially for tasks suited to people getting started in this space, please <a href="https://github.com/rust-osdev/homepage/pulls">create a PR</a> against the <code>next</code> branch with the tasks you want to include in the next issue.</p>
<h2 id="other-projects">Other Projects</h2>
<p>In this section, we describe updates to Rust OS projects that are not directly related to the <code>rust-osdev</code> organization. Feel free to <a href="https://github.com/rust-osdev/homepage/pulls">create a pull request</a> with the updates of your OS project for the next post.</p>
<!--
    Please use the following template:

    ### [`owner_name/repo_name`](https://github.com/rust-osdev/owner_name/repo_name)
    <span class="maintainers">(Section written by [@your_github_name](https://github.com/your_github_name))</span>

    ...<<your project updates>>...
-->
<h3 id="bendudson-euralios"><a href="https://github.com/bendudson/EuraliOS"><code>bendudson/EuraliOS</code></a></h3>
<p><span class="maintainers">(Section written by <a href="https://github.com/bendudson">@bendudson</a>)</span></p>
<p>EuraliOS is a hobby multitasking operating system written in
Rust. It's based on a microkernel (&quot;Merriwig&quot;) that provides on-demand
paging, stack and heap memory management for multi-threaded user
processes. Drivers run in Ring 3 and communication between processes
is by Rendezvous message passing. Each process can have its own
virtual file system, enabling multiple users to be isolated from each
other.</p>
<p>This still has many rough edges and doesn't have many drivers:
EuraliOS only has ramdisk storage, but does have a TCP stack thanks to
the <a href="https://github.com/smoltcp-rs/smoltcp">smoltcp</a> crate. The only
user programs are a simple shell and a
<a href="https://en.wikipedia.org/wiki/Gopher_(protocol)">Gopher</a> client; I'm
trying to port the <a href="https://github.com/ilai-deutel/kibi">kibi</a> text
editor but have a lot of work to do on the standard library.</p>
<p>This was based on <a href="https://os.phil-opp.com/">Phil's blog</a> and uses
many rust-osdev crates including
<a href="https://github.com/rust-osdev/x86_64">x86_64</a>,
<a href="https://github.com/rust-osdev/bootloader">bootloader</a> and
<a href="https://github.com/rust-osdev/vga">vga</a>. Thanks to Phil and
Rust-OSdev contributors for all their work supporting this community!</p>
<p>I've tried to
<a href="https://github.com/bendudson/EuraliOS#documentation">document</a> the
development steps and hope these are useful for others, particularly
the sections on getting into Ring 3, implementing syscalls and
switching stacks with <code>swapgs</code>. Suggestions for improvement welcome!</p>
<h3 id="hermitcore-hermit-sync"><a href="https://github.com/hermitcore/hermit-sync"><code>hermitcore/hermit-sync</code></a></h3>
<p><span class="maintainers">(Section written by <a href="https://github.com/mkroening">@mkroening</a>)</span></p>
<p>While working on the <a href="https://github.com/hermitcore/libhermit-rs"><code>libhermit-rs</code></a> kernel, I moved the synchronization primitives targeted at kernel development into a separate crate: <a href="https://github.com/hermitcore/hermit-sync"><code>hermit-sync</code></a>.
Whilst I was there, I also enhanced the code and made it independent from libhermit, so the code can now be used in other projects as well; at least x86_64 and aarch64 ones for the moment.</p>
<p>The crate contains the following features:</p>
<ul>
<li>a function for running a closure without interrupts</li>
<li>a simple spinlock with exponential backoff</li>
<li>a fair ticket lock with exponential backoff</li>
<li><code>OnceCell</code> and <code>Lazy</code> based on <a href="https://github.com/mkroening/generic_once_cell"><code>generic_once_cell</code></a> (another recent project of mine)</li>
</ul>
<p>All of these primitives are available with and without interrupt safety.
See the <a href="https://docs.rs/hermit-sync">API docs</a> for more details.</p>
<p>Any feedback is very welcome of course.</p>
<h3 id="phip1611-paging-calculator"><a href="https://github.com/phip1611/paging-calculator"><code>phip1611/paging-calculator</code></a></h3>
<p><span class="maintainers">(Section written by <a href="https://github.com/phip1611">@phip1611</a>)</span></p>
<p>I worked on setting up page tables in a low-level project and noticed that there is lots of room for
confusion. For example, x86 has at least four different modes of paging: 32-bit paging, 32-bit
paging with PAE, 64-bit 4-level paging, and 64-bit 5-level paging. 32-bit without PAE paging uses 10
bits to index into a page table while 64-bit paging uses 9 bits to index into the table of each
level. To demystify the magic a little, I created a CLI utility called <code>paging-calculator</code> that
takes a virtual address as input and shows you the indices the hardware will use. You can find the
utility on <a href="https://crates.io/crates/paging-calculator">crates.io</a>.</p>
<h2 id="join-us">Join Us?</h2>
<p>Are you interested in Rust-based operating system development? Our <code>rust-osdev</code> organization is always open to new members and new projects. Just let us know if you want to join! A good way for getting in touch is our <a href="https://rust-osdev.zulipchat.com">Zulip chat</a>.</p>


    <h2 id="comment-form">Comments</h2>

    <script src="https://utteranc.es/client.js"
        repo="rust-osdev/homepage"
        issue-term="url"
        theme="github-light"
        crossorigin="anonymous"
        async>
    </script>
</main>

            <footer class="footer">
                <hr>
                <small>Join us on <a href="https://rust-osdev.zulipchat.com">Zulip.</a><br>
                    &copy; <time datetime="2020">2020</time>-<time datetime="2022">2022</time>. All rights reserved.
                    <a href="https://rust-osdev.com/contact/">Contact</a>
                </small>
            </footer>
        </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
</body>

</html>
